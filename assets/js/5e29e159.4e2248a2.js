"use strict";(self.webpackChunkapache_website_template=self.webpackChunkapache_website_template||[]).push([[642],{2433:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"graphite","title":"Importing results from Graphite","description":"See otava.yaml for the full example configuration.","source":"@site/docs/graphite.md","sourceDirName":".","slug":"/graphite","permalink":"/docs/graphite","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/otava-website/tree/master/docs/graphite.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Basics","permalink":"/docs/basics"},"next":{"title":"PostgreSQL","permalink":"/docs/postgresql"}}');var r=t(3420),s=t(3774);const i={},o="Importing results from Graphite",c={},l=[{value:"Graphite and Grafana Connection",id:"graphite-and-grafana-connection",level:2},{value:"Tests",id:"tests",level:2},{value:"Importing results from Graphite",id:"importing-results-from-graphite-1",level:3},{value:"Tags",id:"tags",level:3},{value:"Example",id:"example",level:2}];function h(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"importing-results-from-graphite",children:"Importing results from Graphite"})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"https://github.com/apache/otava/tree/master/examples/graphite/otava.yaml",children:"otava.yaml"})," for the full example configuration."]})}),"\n",(0,r.jsx)(n.h2,{id:"graphite-and-grafana-connection",children:"Graphite and Grafana Connection"}),"\n",(0,r.jsx)(n.p,{children:"The following block contains Graphite and Grafana connection details:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"graphite:\n  url: ...\n\ngrafana:\n  url: ...\n  user: ...\n  password: ...\n"})}),"\n",(0,r.jsxs)(n.p,{children:["These variables can be specified directly in ",(0,r.jsx)(n.code,{children:"otava.yaml"})," or passed as environment variables:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"graphite:\n  url: ${GRAPHITE_ADDRESS}\n\ngrafana:\n  url: ${GRAFANA_ADDRESS}\n  user: ${GRAFANA_USER}\n  password: ${GRAFANA_PASSWORD}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"tests",children:"Tests"}),"\n",(0,r.jsx)(n.h3,{id:"importing-results-from-graphite-1",children:"Importing results from Graphite"}),"\n",(0,r.jsx)(n.p,{children:"Test configuration contains queries selecting experiment data from Graphite. This is done by specifying the Graphite\npath prefix common for all the test's metrics and suffixes for each of the metrics recorded by the test run."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"tests:\n  my-product.test:\n    type: graphite\n    prefix: performance-tests.daily.my-product\n    metrics:\n      throughput:\n        suffix: client.throughput\n      response-time:\n        suffix: client.p50\n        direction: -1    # lower is better\n      cpu-load:\n        suffix: server.cpu\n        direction: -1    # lower is better\n"})}),"\n",(0,r.jsx)(n.h3,{id:"tags",children:"Tags"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["[!WARNING]\nTags do not work as expected in the current version. See ",(0,r.jsx)(n.a,{href:"https://github.com/apache/otava/issues/24",children:"https://github.com/apache/otava/issues/24"})," for more details"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The optional ",(0,r.jsx)(n.code,{children:"tags"})," property contains the tags that are used to query for Graphite events that store\nadditional test run metadata such as run identifier, commit, branch and product version information."]}),"\n",(0,r.jsx)(n.p,{children:"The following command will post an event with the test run metadata:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'$ curl -X POST "http://graphite_address/events/" \\\n    -d \'{\n      "what": "Performance Test",\n      "tags": ["perf-test", "daily", "my-product"],\n      "when": 1537884100,\n      "data": {"commit": "fe6583ab", "branch": "new-feature", "version": "0.0.1"}\n    }\'\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Posting those events is not mandatory, but when they are available, Otava is able to\nfilter data by commit or version using ",(0,r.jsx)(n.code,{children:"--since-commit"})," or ",(0,r.jsx)(n.code,{children:"--since-version"})," selectors."]}),"\n",(0,r.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,r.jsx)(n.p,{children:"Start docker-compose with Graphite in one tab:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker-compose -f examples/graphite/docker-compose.yaml up --force-recreate --always-recreate-deps --renew-anon-volumes --build\n"})}),"\n",(0,r.jsx)(n.p,{children:"Run otava in another tab:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker-compose -f examples/graphite/docker-compose.yaml run otava otava analyze my-product.test --since=-10m\n"})}),"\n",(0,r.jsx)(n.p,{children:"Expected output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"time                       run    branch    version    commit      throughput    response_time    cpu_usage\n-------------------------  -----  --------  ---------  --------  ------------  ---------------  -----------\n2024-12-14 22:45:10 +0000                                               61160               87          0.2\n2024-12-14 22:46:10 +0000                                               60160               85          0.3\n2024-12-14 22:47:10 +0000                                               60960               89          0.1\n                                                                 \xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7                   \xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\n                                                                        -5.6%                       +300.0%\n                                                                 \xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7                   \xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\xb7\n2024-12-14 22:48:10 +0000                                               57123               88          0.8\n2024-12-14 22:49:10 +0000                                               57980               87          0.9\n2024-12-14 22:50:10 +0000                                               56950               85          0.7\n"})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},3774:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var a=t(6672);const r={},s=a.createContext(r);function i(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);